<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>計測Data 簡易グラフ化サイト</title>
    <link rel="stylesheet" href="homepage.css">
    <script src = "chart.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src = "script.js"></script>


</head>
<body>
<h1>計測Data 簡易グラフ化サイト</h1>
<!-- inputタグでCSVファイルを選択 -->
<input type="file" id="fileInput" accept=".csv" multiple />

<button class="saveButton" id="saveButton">PDFをダウンロード</button>

<div class="container" style="width:500px;height:300px;">
  <canvas id="chart1"></canvas>
  <canvas id="chart2"></canvas>
  <canvas id="chart3"></canvas>
</div>

<div class="container" style="width:500px;height:300px;">
  <canvas id="chart4"></canvas>
  <canvas id="chart5"></canvas>
  <canvas id="chart6"></canvas>
</div>

<script>
const fileSave = document.getElementById("saveButton");

fileSave.addEventListener("click" , () => {

  const element = document.body; // 対象要素を指定
  const option = {
    margin: 0, // 余白
    filename: 'fileName.pdf', // ファイル名
    image: { type: 'png', quality: 1 }, // PDFの生成に使用される画像のタイプとクオリティ
    html2canvas: { scale: 2, useCORS: true }, // html2canvasで使用される設定を記述。
    jsPDF: { format: 'a2', orientation: 'portrait' }, // jsPDFで使用される設定を記述
  };

  html2pdf()
    .from(element)
    .set(option)
    .save()
    .then(() => {
        // 成功
    })
    .catch((e) => {
        // 失敗
    });
  })

// inputタグの要素を取得
const fileInput = document.getElementById("fileInput");
const timedata = []; const swadata = []; const swtdata = []; const yrdata = [];
const xdata = []; const ydata = [];  

// ファイルが選択されたら、読み込む
fileInput.addEventListener("change", function (event) {
  const file = event.target.files[0];
  readFile(file);
});

// FileReader APIを使ってファイルを読み込む関数
function readFile(file) {
  const reader = new FileReader();
  // 読み込みが完了したら、CSVデータを処理してグラフを描画
  reader.onload = function (event) {
    const csvData = event.target.result;
    processGraphDataCreate(processData(csvData));

    // データでグラフを書く
    processGraph("chart1","case1",timedata,swadata,"time [s]" ,"SWA [deg]");
    processGraph("chart2","case1",timedata,swtdata,"time [s]" ,"SWT [Nm]");
    processGraph("chart3","case1",timedata,yrdata,"time [s]" ,"Yaw Rate [deg/s]");
    processGraph("chart4","case1",xdata,ydata,"X disp [m]" ,"Y disp [m]");
    processGraph("chart5","case1",xdata,ydata,"X disp [m]" ,"Y disp [m]");
    processGraph("chart6","case1",xdata,ydata,"X disp [m]" ,"Y disp [m]");
  };
  // ファイルをテキストとして読み込む
  reader.readAsText(file);
}

</script>

</body>
</html>
